<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Americano/Mexicano Tenis Manager - WIMBLEDON EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* WIMBLEDON PALETTE */
        :root {
            --wimbledon-purple: #460046; /* Deep Purple */
            --wimbledon-green: #006400;  /* Dark Green */
            --wimbledon-white: #ffffff;
            --wimbledon-light-grey: #f0f0f0;
            --wimbledon-accent: #ffd700; /* Gold for highlight */
        }

        /* BASE & LAYOUT */
        body { 
            font-family: 'Roboto', sans-serif; 
            margin: 0; 
            background-color: var(--wimbledon-light-grey); 
            color: #333; 
            line-height: 1.6;
        }
        
        /* HEADER KECIL BARU UNTUK HANIFF */
        .sub-header-haniif {
            background-color: var(--wimbledon-green); /* Green bar */
            color: var(--wimbledon-accent); /* Gold text */
            padding: 5px 40px;
            font-size: 0.85em;
            text-align: center;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .header { 
            background: var(--wimbledon-purple); 
            color: var(--wimbledon-white); 
            padding: 20px 40px; 
            font-size: 30px; 
            font-family: 'Playfair Display', serif; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }
        .container { 
            max-width: 1200px; 
            margin: 30px auto; 
            padding: 0 20px; 
        }
        h2 { 
            color: var(--wimbledon-green); 
            border-bottom: 3px solid #dcdcdc; 
            padding-bottom: 8px; 
            margin-top: 30px; 
            font-weight: 800; 
            font-size: 1.8em;
        }
        .card { 
            background: var(--wimbledon-white); 
            padding: 25px; 
            border-radius: 10px; 
            box-shadow: 0 3px 8px rgba(0,0,0,0.1); 
            margin-bottom: 25px; 
            border-left: 5px solid var(--wimbledon-purple); /* Accent border */
        }

        /* FORMS & INPUTS */
        .form-inline { 
            display: flex; 
            gap: 15px; 
            align-items: center; 
            flex-wrap: wrap;
        }
        input[type="text"], input[type="number"], select { 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            transition: border-color 0.3s;
        }
        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            border-color: var(--wimbledon-purple);
            outline: none;
        }

        /* BUTTONS */
        .btn-base {
            padding: 10px 18px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: background-color 0.2s, box-shadow 0.2s;
        }
        .btn-base:hover {
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .btn-primary { 
            background-color: var(--wimbledon-green); 
            color: var(--wimbledon-white); 
        }
        .btn-primary:hover { background-color: #004d00; }
        .btn-warning { 
            background-color: var(--wimbledon-accent); 
            color: var(--wimbledon-purple); 
            font-size: 0.9em;
            padding: 8px 15px;
        }
        .btn-warning:hover { background-color: #e0c500; }
        .btn-danger-small { 
            background-color: var(--wimbledon-purple); 
            color: white; 
            padding: 4px 8px; 
            font-size: 0.7em; 
            margin-left: 10px;
        }
        .btn-danger-small:hover { background-color: #330033; }
        .btn-danger { 
            background-color: var(--wimbledon-purple); 
            color: var(--wimbledon-white); 
            padding: 15px 25px; 
            text-decoration: none; 
            display: inline-block;
            font-weight: 700;
        }
        .btn-danger:hover { background-color: #330033; }
        .btn-base[disabled] { 
            opacity: 0.6; 
            cursor: not-allowed; 
            box-shadow: none;
        }

        /* RANKING TABLE */
        .ranking-table { 
            width: 100%; 
            border-collapse: collapse; 
            border-spacing: 0;
            overflow: hidden;
        }
        .ranking-table th { 
            background-color: var(--wimbledon-green); 
            color: white; 
            padding: 12px; 
            text-align: left; 
            font-weight: 600;
        }
        .ranking-table td { 
            border: none; 
            padding: 10px; 
            background-color: var(--wimbledon-white);
            border-bottom: 1px solid #dcdcdc; 
        }
        .ranking-table tr:nth-child(even) td { background-color: var(--wimbledon-light-grey); } 
        .ranking-table tbody tr:hover td { background-color: #e6e6e6; } 

        /* MATCH CARDS */
        .match-card { 
            border: 1px solid #ccc; 
            padding: 20px; 
            margin-top: 15px; 
            border-radius: 5px;
        }
        .match-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-weight: 700; 
            margin-bottom: 10px; 
            color: var(--wimbledon-purple);
        }
        .status-selesai { 
            background-color: #e8f5e9; /* Light Green */
            border-color: var(--wimbledon-green);
        }
        .status-belum { 
            background-color: #fffde7; /* Light Gold/Yellow */
            border-color: var(--wimbledon-accent);
        }
        
        .score-input-group { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 20px; 
            align-items: center; 
            margin-top: 15px; 
        }
        .score-input-group label { 
            font-size: 0.9em; 
            color: #666; 
            margin-bottom: 3px; 
        }
        .score-input-group input[type="number"] { 
            width: 80px; 
            text-align: center;
        }

        /* BYE & INFO */
        .bye-info {
            background-color: #ffccbc; /* Light Peach */
            color: var(--wimbledon-purple);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: 600;
            border: 1px dashed var(--wimbledon-purple);
        }
        .info-note {
            font-size: 0.8em; 
            color: #666; 
            margin-top: 5px;
        }
        .team-1-color { color: var(--wimbledon-purple); }
        .team-2-color { color: var(--wimbledon-green); }

    </style>
</head>
<body>
    <div class="sub-header-haniif">
        Made by Haniif
    </div>
    
    <div class="header">
        Even Play for Everybody
    </div>

    <div class="container">
        
        <div class="card">
            <h2>üë• Tambah Pemain</h2>
            <form action="{{ url_for('tambah_pemain') }}" method="post" class="form-inline">
                <input type="text" name="nama_pemain" placeholder="Nama Pemain Baru" required style="flex-grow: 1;">
                <button type="submit" class="btn-base btn-primary">‚ûï Tambah Pemain</button>
            </form>
        </div>
        
        <div class="card">
            <h2>üìä Peringkat Saat Ini</h2>
            {% if peringkat %}
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nama</th>
                        <th style="text-align: center;">Total Poin</th>
                        <th>W/L/T</th> 
                        <th>Games Dimainkan</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in peringkat %}
                    <tr>
                        <td>{{ p.Peringkat }}</td> 
                        <td>
                            {{ p.Nama }}
                            <form action="{{ url_for('hapus_pemain', player_id=p.ID) }}" method="post" style="display: inline;" onsubmit="return confirm('Apakah Anda yakin ingin menghapus {{ p.Nama }}? Ini akan membatalkan jadwal putaran saat ini.');">
                                <button type="submit" class="btn-base btn-danger-small">‚ùå</button>
                            </form>
                        </td>
                        <td style="text-align: center; font-weight: 700; color: var(--wimbledon-purple);">{{ p.Total_Poin }}</td>
                        <td>{{ p.W }}/{{ p.L }}/{{ p.T }}</td> 
                        <td>{{ p.Games_Played }}</td>
                        <td></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <p class="info-note" style="color: #666;">* Menghapus pemain akan otomatis membatalkan seluruh jadwal di putaran saat ini.</p>
            {% else %}
            <p>Belum ada pemain terdaftar. Silakan tambahkan pemain di atas.</p>
            {% endif %}
        </div>
        
        <div class="card">
            <h2>üöÄ Atur Putaran Berikutnya (Putaran {{ putaran + 1 }})</h2>
            <form action="{{ url_for('mulai_putaran') }}" method="post" class="form-inline">
                
                <label for="mode_permainan">Mode:</label>
                <select name="mode_permainan" id="mode_permainan" style="width: auto;">
                    <option value="Double">Double (2v2)</option>
                    <option value="Single" {% if peringkat|length < 2 %} disabled {% endif %}>Single (1v1)</option>
                </select>
                
                <label for="format_turnamen">Format:</label>
                <select name="format_turnamen" id="format_turnamen" style="width: auto;">
                    <option value="Americano">Americano (Acak)</option>
                    <option value="Mexicano" {% if peringkat|length < 4 %} disabled {% endif %}>Mexicano (Peringkat)</option>
                </select>
                
                <label for="num_lapangan">Lapangan:</label>
                <select name="num_lapangan" id="num_lapangan" style="width: auto;">
                    {% for num in max_lapangan_pilihan %}
                        <option value="{{ num }}">{{ num }} Lapangan</option>
                    {% endfor %}
                </select>
                
                <button type="submit" class="btn-base btn-primary" 
                    {% if peringkat|length < 2 %} disabled {% endif %}
                >Buat Jadwal Putaran {{ putaran + 1 }}</button>
            </form>
            {% if peringkat|length < 2 %}
            <p style="color:var(--wimbledon-purple); margin-top:10px;">*Minimal 2 pemain diperlukan untuk mode Single, dan 4 pemain untuk mode Double/Mexicano.</p>
            {% endif %}
        </div>
        
        {% if putaran > 0 %} 
        <div class="card" style="border-left: 5px solid var(--wimbledon-green);">
            <h2>üìÖ Jadwal Putaran {{ putaran }} (Mode: {{ current_mode }} ‚Äî Format: {{ current_format }})</h2>
            
            {% if pemain_bye %}
                <div class="bye-info">
                    üëã **Bye (Tidak Bermain) di Putaran Ini:** {% for nama in pemain_bye %}
                        {{ nama }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </div>
            {% endif %}

            {% if can_reshuffle %}
                <form action="{{ url_for('kocok_ulang') }}" method="post" class="form-inline" style="margin-bottom: 20px; border: none; background: none; padding: 0;">
                    <input type="hidden" name="num_lapangan_ulang" value="{{ jadwal[0].Lapangan }}">
                    
                    <label for="format_turnamen_ulang">Format Kocok Ulang:</label>
                    <select name="format_turnamen_ulang" id="format_turnamen_ulang" style="width: auto;">
                         <option value="Americano">Americano (Acak)</option>
                         <option value="Mexicano" {% if peringkat|length < 4 %} disabled {% endif %}>Mexicano (Peringkat)</option>
                    </select>

                    <input type="hidden" name="mode_permainan_ulang" value="{{ current_mode }}">
                    <button type="submit" class="btn-base btn-warning">üîÑ Kocok Ulang Putaran Ini! (Belum ada skor masuk)</button>
                    <p class="info-note">*Akan membuat jadwal baru menggunakan mode dan jumlah lapangan yang sama. Pilih format di atas.</p>
                </form>
            {% elif jadwal %}
                <p class="info-note" style="color: var(--wimbledon-green);">*Beberapa pertandingan sudah memiliki skor. Kocok ulang tidak tersedia.</p>
            {% endif %}
            
            {% if jadwal %}
                {% for match in jadwal %}
                <form action="{{ url_for('input_skor', match_id=match.Match_ID) }}" method="post" class="match-card {% if match.Status == 'Selesai' %}status-selesai{% else %}status-belum{% endif %}">
                    
                    <div class="match-header">
                        <span style="color: var(--wimbledon-green);">Lapangan {{ match.Lapangan }}</span>
                        <span>Status: <strong style="color: {% if match.Status == 'Selesai' %}var(--wimbledon-green){% else %}var(--wimbledon-accent){% endif %};">{{ match.Status }}</strong></span>
                    </div>

                    {% if match.Mode == 'Double' %}
                        <p>Pasangan: 
                            <strong class="team-1-color">({{ match.Pemain_1_A_Nama }} & {{ match.Pemain_1_B_Nama }})</strong> VS 
                            <strong class="team-2-color">({{ match.Pemain_2_A_Nama }} & {{ match.Pemain_2_B_Nama }})</strong>
                        </p>
                    {% else %}
                        <p>Pertandingan: 
                            <strong class="team-1-color">{{ match.Pemain_1_A_Nama }}</strong> VS 
                            <strong class="team-2-color">{{ match.Pemain_2_A_Nama }}</strong>
                        </p>
                    {% endif %}
                    
                    <div class="score-input-group">
                        <div style="flex: 1;">
                            <label>Skor Tim 1 (Ungu):</label>
                            <input type="number" name="skor_tim_1" value="{{ match.Poin_Tim_1 }}" min="0" max="30" required>
                            <span style="font-size: 0.8em; color: var(--wimbledon-purple);">({{ match.Pemain_1_A_Nama }}...)</span>
                        </div>
                        <div style="flex: 1;">
                            <label>Skor Tim 2 (Hijau):</label>
                            <input type="number" name="skor_tim_2" value="{{ match.Poin_Tim_2 }}" min="0" max="30" required>
                            <span style="font-size: 0.8em; color: var(--wimbledon-green);">({{ match.Pemain_2_A_Nama }}...)</span>
                        </div>
                        <button type="submit" class="btn-base btn-primary">Simpan/Update Skor</button>
                    </div>
                    
                </form>
                {% endfor %}
            {% else %}
                <p>Belum ada pertandingan terjadwal untuk putaran ini.</p>
            {% endif %}
        </div>
        {% endif %}

        <div class="card" style="background-color: #f7f7f7; border-left: 5px solid var(--wimbledon-green);">
            <h2>üõë Akhiri Turnamen & Rekap Skor</h2>
            {% if putaran > 0 %}
                <p>Lihat Peringkat Final turnamen dalam format visual yang elegan.</p>
                <a href="{{ url_for('rekap_visual') }}" class="btn-base btn-danger">
                   üëë Game Recap
                </a>
            {% else %}
                <p>Mulai setidaknya satu putaran untuk mengakhiri turnamen.</p>
            {% endif %}
        </div>
        
    </div>
</body>

</html>
